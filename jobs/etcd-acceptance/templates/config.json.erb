<%
def node_name(instance)
  # As specified in kubo-etcd https://github.com/pivotal-cf-experimental/kubo-etcd/blob/8cc5af9c47e15b6c9eebb0712b0fa50a8c700241/src/etcdfab/config/config.go#L106-L111
  "#{instance.name.gsub('_','-')}-#{instance.index}"
end

etcd_addresses = link('etcd').instances.map { |instance| instance.address }
aliases = []

etcd_advertise_urls_dns_suffix = link('etcd').p('etcd.advertise_urls_dns_suffix')
etcd_endpoints = link('etcd').instances.map { |instance| "https://#{node_name(instance)}.#{etcd_advertise_urls_dns_suffix}:4001" }

config = {
  endpoints: etcd_endpoints,
  client_cert_path: "/var/vcap/jobs/etcd-acceptance/config/client.crt",
  client_key_path: "/var/vcap/jobs/etcd-acceptance/config/client.key",
  client_ca_path: "/var/vcap/jobs/etcd-acceptance/config/client-ca.crt",
}
%>
<%= config.to_json %>
